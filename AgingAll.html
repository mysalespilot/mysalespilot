<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Power BI Dashboard Viewer & Excel Data</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      overflow: hidden;
    }
    #loginBox, #reportPage {
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; height: 100%; padding: 10px;
    }
    .login-box {
      background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3); text-align:center; width:100%; max-width:400px;
    }
    input[type="number"] { width:90%; padding:12px; margin:15px 0; border:none; border-radius:8px; font-size:1.1rem; }
    button { padding:12px 24px; background-color:#ffffff33; color:white; border:2px solid white; border-radius:8px; font-size:1rem; cursor:pointer; transition:0.3s; margin:10px;}
    button:hover { background-color:#ffffff55; transform:scale(1.05);}
    #exportCSVBtn { color:black; font-weight:bold; background-color:#ffffffaa; border:2px solid black; }
    #error { color:#ffcccc; display:none; margin-top:10px;}
    .dashboard-layout { display:flex; height:100%; width:100%; }
    .sidebar { width:220px; background-color:rgba(0,0,0,0.3); padding-top:20px; display:flex; flex-direction:column; }
    .menu-item { padding:15px 20px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.2); font-size:1.1rem; }
    .menu-item:hover { background-color:rgba(255,255,255,0.2); }
    .content-area { flex:1; padding:10px; display:flex; flex-direction:column; overflow-y:auto; background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); color:#212529;}
    .report-container { flex:1; border:6px solid #ffffff80; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,0.3); background-color:rgba(255,255,255,0.05); display:flex; flex-direction:column; overflow:hidden; padding:20px; margin-bottom:20px;}
    table { width:100%; border-collapse:collapse; }
  </style>

  <!-- jQuery and DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
</head>
<body>

  <!-- Login Screen -->
  <div id="loginBox">
    <div class="login-box">
      <h2>Login to View Sale Order Aging Dashboard</h2>
      <input type="number" id="loginNumber" placeholder="Enter Your Number" />
      <br />
      <button onclick="validateLogin()">Login</button>
      <p id="error">Invalid number. Try again.</p>
    </div>
  </div>

  <!-- Dashboard Page -->
  <div id="reportPage" style="display: none;">
    <div class="dashboard-layout">
      <div class="sidebar">
        <div class="menu-item" onclick="showSection('powerbi')">üìä Power BI Report</div>
        <div class="menu-item" onclick="showSection('excel')">üì• Excel Data View</div>
      </div>
      <div class="content-area">
        <!-- Power BI Section -->
        <div id="powerbiSection" class="report-container">
          <iframe id="reportFrame" src="" allowfullscreen></iframe>
        </div>
        <!-- Excel Section -->
        <div id="excelSection" class="report-container" style="display:none; flex-direction: column;">
          <button id="exportCSVBtn">‚¨áÔ∏è Export as CSV</button>
          <table id="excelTable" class="display"></table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    const summaryURL = "https://app.powerbi.com/view?r=eyJrIjoiYTRiMjIxMjMtYzM3Zi00MTMxLWEwNTktODRiODI1ZGJkNTVmIiwidCI6ImNhNGVlODZhLTk2Y2MtNGY0Ni05OWI4LTY5ZjMxNmUwNmQ0YiJ9";
    const allowedNumbers = ['900421', '900898', '900021', '901044'];
    const allowedHeaders = [
      "Contract No","Created On Date","Created on Time","Contract Type","PO No.","User Id","Sales Organization",
      "Distribution Channel","Division","Sold to Party","Sold to Party Name","Ship to Party","Ship to Party Name",
      "Ship to Party City","Ship to Party Region","Ship to Party District","Bill to Party","Bill to Party Name",
      "Payer","Payer Name","Customer Group","Customer Grp. Description","Cutomer Group-1","Cutomer Group-1 Description",
      "Cutomer Group-2","Cutomer Group-2 Description","Cutomer Group-3","Cutomer Group-3 Description","Cutomer Group-4",
      "Cutomer Group-4 Description","Cutomer Group-5","Cutomer Group-5 Description","Contract Item","Contract Item_1",
      "Material","Material Desc","Inco Term 1","Inco Term 2","Payment Term","Quantity","Uom","Quantity in MTS","Plant",
      "Plant State","Material group1","Material group_1","Material group2","Material group_2","Material group3",
      "Material group_3","Material group4","Material group_4","Material group5","Material group_5","Material group__5",
      "PACK_TYPE","Rate Before Discount","Discount","Net Selling Rate (ZASS)","Net Weight per Unit","Net Weight unit",
      "ZFRC For Component","Packing Cost per Unit","Freight Charges","Depot Expense","Other expenses",
      "Scheme & FI Cost per SKU","Additional Cost","(ZTPD)- Terms of Paymt DISC","Total Add On","ZDPD-Price Discount",
      "ZPRI - Sale Price","Price Difference","Freight After ZPRI-M","Duty","Roll Over Cost","Realized Rate",
      "Realized Value","Realization Per MTS","Balance Invoice Qty","Balance Invoice Qty Uom","Bal Inv Qty in Sale Unit",
      "Bal Inv Qty Sales Unit Uom","Pen.Rel Value","Status","Refrence Contract","Sum Contract","Valid From","Valid To"
    ];

    function validateLogin() {
      const enteredNumber = document.getElementById('loginNumber').value;
      if (allowedNumbers.includes(enteredNumber)) {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('reportPage').style.display = 'flex';
        showReport();
        loadCSV();
      } else {
        document.getElementById('error').style.display = 'block';
      }
    }

    function showReport() {
      const reportFrame = document.getElementById('reportFrame');
      const timestamp = new Date().getTime();
      reportFrame.src = summaryURL + `&ts=${timestamp}`;
    }

    function showSection(section) {
      document.getElementById('powerbiSection').style.display = section === 'powerbi' ? 'flex' : 'none';
      document.getElementById('excelSection').style.display = section === 'excel' ? 'flex' : 'none';
    }

    function loadCSV() {
      const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTsCPqfjtbX78fqypZKDzdTTZ6dbZv3WJ3C_Bsfg7i8VEGfwTKYSauTcaA7ybqXD8REepI4bpU0omLA/pub?gid=0&single=true&output=csv";
      Papa.parse(csvURL, {
        download: true,
        header: true,
        complete: function(results) {
          const filteredData = results.data.map(row => {
            let obj = {};
            allowedHeaders.forEach(h => obj[h] = row[h] || "");
            return obj;
          });
          buildTable(filteredData);
        }
      });
    }

    function buildTable(data) {
      const table = $('#excelTable').DataTable({
        data: data,
        destroy: true,
        columns: allowedHeaders.map(h => ({ title: h, data: h })),
        pageLength: 20,
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'csv',
            text: '‚¨áÔ∏è Export as CSV',
            className: 'dt-button',
            filename: 'Sale_Order_Aging'
          }
        ]
      });
    }

    // Manual CSV button for download without DataTables
    document.getElementById('exportCSVBtn').addEventListener('click', function() {
      const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTsCPqfjtbX78fqypZKDzdTTZ6dbZv3WJ3C_Bsfg7i8VEGfwTKYSauTcaA7ybqXD8REepI4bpU0omLA/pub?gid=0&single=true&output=csv";
      const link = document.createElement('a');
      link.href = csvURL;
      link.download = "Sale_Order_Aging.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

  </script>

</body>
</html>
